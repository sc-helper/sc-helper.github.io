import{_ as L,V as N}from"./DYwC_DRM.js";import{ay as G,aQ as w,B as b,C as K,R as U,aR as X,aS as Y,aT as Q,w as S,aU as O,aV as Z,aW as x,u as D,aX as q,c as E,D as g,l as J,d as M,aY as A,aZ as ee,O as ae,a as te,o as B,m as z,a_ as se,_ as j,g as R,a$ as ne,b0 as oe,e as I,r as P,b as k,ah as re,L as ie,ak as ce,S as F,n as le,b1 as de}from"./CV52yZgT.js";import{u as ue}from"./XF-G4Xxk.js";import{a as fe}from"./Dj_ak3gH.js";const pe=e=>e==="defer"||e===!1;function W(...e){var C;const n=typeof e[e.length-1]=="string"?e.pop():void 0;typeof e[0]!="string"&&e.unshift(n);let[a,d,t={}]=e;if(typeof a!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof d!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const s=G(),i=d,r=()=>w.value,f=()=>s.isHydrating?s.payload.data[a]:s.static.data[a];t.server=t.server??!0,t.default=t.default??r,t.getCachedData=t.getCachedData??f,t.lazy=t.lazy??!1,t.immediate=t.immediate??!0,t.deep=t.deep??w.deep,t.dedupe=t.dedupe??"cancel";const u=t.getCachedData(a,s),v=u!=null;if(!s._asyncData[a]||!t.immediate){(C=s.payload._errors)[a]??(C[a]=w.errorValue);const c=t.deep?b:K;s._asyncData[a]={data:c(v?u:t.default()),pending:b(!v),error:U(s.payload._errors,a),status:b("idle"),_default:t.default}}const o={...s._asyncData[a]};delete o._default,o.refresh=o.execute=(c={})=>{if(s._asyncDataPromises[a]){if(pe(c.dedupe??t.dedupe))return s._asyncDataPromises[a];s._asyncDataPromises[a].cancelled=!0}if(c._initial||s.isHydrating&&c._initial!==!1){const p=c._initial?u:t.getCachedData(a,s);if(p!=null)return Promise.resolve(p)}o.pending.value=!0,o.status.value="pending";const h=new Promise((p,l)=>{try{p(i(s))}catch(T){l(T)}}).then(async p=>{if(h.cancelled)return s._asyncDataPromises[a];let l=p;t.transform&&(l=await t.transform(p)),t.pick&&(l=me(l,t.pick)),s.payload.data[a]=l,o.data.value=l,o.error.value=w.errorValue,o.status.value="success"}).catch(p=>{if(h.cancelled)return s._asyncDataPromises[a];o.error.value=x(p),o.data.value=D(t.default()),o.status.value="error"}).finally(()=>{h.cancelled||(o.pending.value=!1,delete s._asyncDataPromises[a])});return s._asyncDataPromises[a]=h,s._asyncDataPromises[a]},o.clear=()=>ve(s,a);const m=()=>o.refresh({_initial:!0}),y=t.server!==!1&&s.payload.serverRendered;{const c=X();if(c&&y&&t.immediate&&!c.sp&&(c.sp=[]),c&&!c._nuxtOnBeforeMountCbs){c._nuxtOnBeforeMountCbs=[];const l=c._nuxtOnBeforeMountCbs;Y(()=>{l.forEach(T=>{T()}),l.splice(0,l.length)}),Q(()=>l.splice(0,l.length))}y&&s.isHydrating&&(o.error.value||u!=null)?(o.pending.value=!1,o.status.value=o.error.value?"error":"success"):c&&(s.payload.serverRendered&&s.isHydrating||t.lazy)&&t.immediate?c._nuxtOnBeforeMountCbs.push(m):t.immediate&&m();const h=Z();if(t.watch){const l=S(t.watch,()=>o.refresh());h&&O(l)}const p=s.hook("app:data:refresh",async l=>{(!l||l.includes(a))&&await o.refresh()});h&&O(p)}const _=Promise.resolve(s._asyncDataPromises[a]).then(()=>o);return Object.assign(_,o),_}function ve(e,n){n in e.payload.data&&(e.payload.data[n]=void 0),n in e.payload._errors&&(e.payload._errors[n]=w.errorValue),e._asyncData[n]&&(e._asyncData[n].data.value=void 0,e._asyncData[n].error.value=w.errorValue,e._asyncData[n].pending.value=!1,e._asyncData[n].status.value="idle"),n in e._asyncDataPromises&&(e._asyncDataPromises[n]&&(e._asyncDataPromises[n].cancelled=!0),e._asyncDataPromises[n]=void 0)}function me(e,n){const a={};for(const d of n)a[d]=e[d];return a}var H;const V=!((H=globalThis==null?void 0:globalThis.CSS)!=null&&H.supports("object-view-box: xywh(1px 1px 1px 1px)")),ye=({src:e,imageRef:n,coords:a,idx:d})=>{const t=q("imageDimensions",()=>({})),s=b(0);return S(()=>g(e),i=>{if(!V||i in t.value)return;t.value[i]=[0,0];const r=new Image;r.onload=async()=>{t.value[i]=[r.width??0,r.height??0]},r.src=i},{immediate:!0}),S(()=>g(n),i=>{var r;i&&(s.value=((r=n.value)==null?void 0:r.clientWidth)??0)},{immediate:!0}),E(()=>{if(!V)return null;const[i,r]=t.value[g(e)]??[0,0],{x:f,y:u,width:v,height:o}=[g(a)].flat()[g(d??0)];if(!s.value||!i||!V)return{};const m=i/v,y=f/(i-v),_=u/(r-o);return{backgroundSize:`${m*100}%`,backgroundPositionX:`${y*100}%`,backgroundPositionY:`${_*100}%`,backgroundImage:`url(${g(e)})`}})},he=window.setInterval,$=Array();J(()=>{he(()=>{$.forEach(e=>e())},1500)});const ge=e=>($.push(e),()=>{const n=$.indexOf(e);n>=0&&$.splice(n,0)}),De=M({__name:"GameIcon",props:{src:{},coords:{},padding:{default:()=>[0,0,0,0]}},setup(e){const n=b(0),a=A(),d=ee("image"),t=ye({src:e.src,imageRef:d,coords:e.coords,idx:n}),s=E(()=>{if(t.value)return{is:"div",style:t.value};const[i,r,f,u]=e.padding,{x:v=0,y:o=0,width:m=1,height:y=1}=Array.isArray(e.coords)?e.coords[n.value]??{}:e.coords??{};return{is:"img",src:e.src,style:{"object-view-box":`xywh(${v+u}px ${o+i}px ${m-r-u}px ${y-f-i}px)`}}});return ae(i=>{if(!Array.isArray(e.coords))return;const r=ge(()=>{n.value=n.value+1>=e.coords.length?0:n.value+1});i(r)}),(i,r)=>(B(),te(se(D(s).is),z({style:D(s).style,src:D(s).src},D(a),{class:"icon",ref:"image"}),null,16,["style","src"]))}}),_e=j(De,[["__scopeId","data-v-f7949771"]]),we=["innerHTML"],be=M({__name:"WarTooltip",props:{description:{},descriptionClass:{},disabled:{type:Boolean},src:{},coords:{},padding:{}},setup(e){const n=ue("tooltipsDisabled","false");return(a,d)=>{const t=L,s=_e;return B(),R("div",ne(oe(a.$attrs)),[I(t,null,{default:k(()=>[I(N,{location:"right top",activator:"parent","max-width":"350","close-on-content-click":"",transition:{component:D(fe)},disabled:a.disabled||D(n)==="true",class:"tooltip-opacity"},{default:k(()=>[P(a.$slots,"tooltip:body",{},()=>[P(a.$slots,"tooltip",{},void 0,!0),a.description?(B(),R("div",{key:0,class:ie([a.descriptionClass,"war-tooltip"]),innerHTML:a.description},null,10,we)):re("",!0),P(a.$slots,"postfix",{},void 0,!0)],!0)]),_:3},8,["transition","disabled"])]),_:3}),I(s,z({src:a.src,coords:a.coords,padding:a.padding,width:"100%"},a.$attrs),null,16,["src","coords","padding"]),P(a.$slots,"default",{},void 0,!0)],16)}}}),Ie=j(be,[["__scopeId","data-v-1eada4f2"]]),Ce=async()=>{const e=ce(),[n]=[e.params.versionType].flat(),[a]=[e.params.version].flat(),d=F("fetchVersionType",n||"og"),t=F("fetchVersion",a||"latest"),{data:s,error:i}=await W(`data-file-${d}-${t}`,()=>{const r=le[d];if(!r)throw new Error("unknown version type");let f=t;f==="latest"&&(f=de[d]);const u=r[f];if(!u)throw new Error("unknown version");return u()});if(s.value,i.value)throw x(i.value??"");return s},Ve=async e=>{var s,i;const n=await Ce();if(!n.value)throw x("no versionIndex");const{data:a}=await W(`race-${n.value.version}-${e}`,()=>{const r=g(n);if(!r||!(e in r.racesData))throw new Error("No race found");return r.racesData[e]()}),d=E(()=>{var r;return(r=n.value)==null?void 0:r.racesIcons[e]});function t(r,f){var u;if(!f||f===1){const[v,o,m,y]=((u=a.value)==null?void 0:u.icons[r])??[0,0,1,1];return{x:v,y:o,width:m,height:y}}return Array.from({length:f},(v,o)=>{var h;const m=`${r}-${o+1}`,[y,_,C,c]=((h=a.value)==null?void 0:h.icons[m])??[0,0,1,1];return{x:y,y:_,width:C,height:c}})}if(!a.value)throw x("no data loaded");return{raceData:(s=a.value)==null?void 0:s.data,raceIconsCoords:(i=a.value)==null?void 0:i.icons,iconProps:t,iconsSrc:d.value,version:n.value.version,versionType:n.value.versionType}};export{Ie as _,_e as a,Ve as u};
