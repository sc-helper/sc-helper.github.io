import{Y as Ke,Q as qe,a3 as We,r as T,U as X,a4 as ne,an as He,c as x,D as j,h as r,m as R,a7 as Qe,ao as he,ap as ge,aq as Xe,X as ye,ar as Ye,g as V,as as Ge,F as N,at as Je,n as Ze,e as et,l as K,d as ce,a5 as tt,aj as Ve,q,o as I,w as E,f as xe,p as L,u as m,B as we,M as ue,a as B,au as at,b as se,_ as Ce}from"./DZzeIQJE.js";import{u as lt,d as nt,e as ot,c as be,f as ut,m as st,g as it,h as rt,b as ie,i as ct,j as dt,k as ke}from"./DP7h-oCU.js";import{u as vt,d as ft}from"./D4a3FrcL.js";import{c as mt,V as pt,b as ht}from"./DFwXgqKA.js";import{V as re}from"./Blmg-fVh.js";import{c as gt,e as yt,j as bt,V as Z,l as kt,h as Vt}from"./CsZK-91R.js";import{u as xt,m as wt,h as Ct,V as St}from"./OG0CjqW7.js";import{f as Dt}from"./DqtmxcHQ.js";import{k as Pt,l as It}from"./u06dbjxb.js";import{u as Se,_ as _t}from"./DiTTdsQc.js";import{V as oe,a as At}from"./BqlHpP0N.js";const Ft=qe({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...wt({filterKeys:["title"]}),...ut(),...Qe(st({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...bt({transition:!1})},"VAutocomplete"),Mt=Ke()({name:"VAutocomplete",props:Ft(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,w){let{slots:a}=w;const{t:D}=We(),s=T(),c=X(!1),k=X(!0),C=X(!1),F=T(),h=T(),n=X(-1),{items:d,transformIn:$,transformOut:z}=lt(e),{textColorClasses:_,textColorStyles:S}=gt(()=>{var t;return(t=s.value)==null?void 0:t.color}),g=ne(e,"search",""),l=ne(e,"modelValue",[],t=>$(t===null?[null]:He(t)),t=>{const o=z(t);return e.multiple?o:o[0]??null}),W=x(()=>typeof e.counterValue=="function"?e.counterValue(l.value):typeof e.counterValue=="number"?e.counterValue:l.value.length),U=vt(e),{filteredItems:H,getMatches:De}=xt(e,d,()=>k.value?"":g.value),M=x(()=>e.hideSelected?H.value.filter(t=>!l.value.some(o=>o.value===t.value)):H.value),Y=x(()=>!!(e.chips||a.chip)),Q=x(()=>Y.value||!!a.selection),Pe=x(()=>l.value.map(t=>t.props.value)),ee=x(()=>{var o;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&g.value===((o=M.value[0])==null?void 0:o.title))&&M.value.length>0&&!k.value&&!C.value}),G=x(()=>e.hideNoData&&!M.value.length||U.isReadonly.value||U.isDisabled.value),te=ne(e,"menu"),y=x({get:()=>te.value,set:t=>{var o;te.value&&!t&&((o=F.value)!=null&&o.ΨopenChildren.size)||t&&G.value||(te.value=t)}}),{menuId:Ie,ariaExpanded:_e,ariaControls:Ae,ariaLabel:de}=nt(e,y),ae=T(),Fe=ot(ae,s);function Me(t){e.openOnClear&&(y.value=!0),g.value=""}function Re(){G.value||(y.value=!0)}function Le(t){G.value||(c.value&&(t.preventDefault(),t.stopPropagation()),y.value=!y.value)}function Te(t){var o;(he(t)||t.key==="Backspace")&&((o=s.value)==null||o.focus())}function Ue(t){var u,p,P,A,i;if(U.isReadonly.value)return;const o=(u=s.value)==null?void 0:u.selectionStart,f=l.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(t.key)&&t.preventDefault(),["Enter","ArrowDown"].includes(t.key)&&(y.value=!0),["Escape"].includes(t.key)&&(y.value=!1),ee.value&&["Enter","Tab"].includes(t.key)&&!l.value.some(v=>{let{value:b}=v;return b===M.value[0].value})&&O(M.value[0]),t.key==="ArrowDown"&&ee.value&&((p=ae.value)==null||p.focus("next")),["Backspace","Delete"].includes(t.key)){if(!e.multiple&&Q.value&&l.value.length>0&&!g.value)return O(l.value[0],!1);if(~n.value){t.preventDefault();const v=n.value;O(l.value[n.value],!1),n.value=v>=f-1?f-2:v}else t.key==="Backspace"&&!g.value&&(n.value=f-1);return}if(e.multiple)if(t.key==="ArrowLeft"){if(n.value<0&&o&&o>0)return;const v=n.value>-1?n.value-1:f-1;if(l.value[v])n.value=v;else{const b=((P=g.value)==null?void 0:P.length)??null;n.value=-1,(A=s.value)==null||A.setSelectionRange(b,b)}}else if(t.key==="ArrowRight"){if(n.value<0)return;const v=n.value+1;l.value[v]?n.value=v:(n.value=-1,(i=s.value)==null||i.setSelectionRange(0,0))}else~n.value&&he(t)&&(n.value=-1)}function Oe(t){if(ge(s.value,":autofill")||ge(s.value,":-webkit-autofill")){const o=d.value.find(f=>f.title===t.target.value);o&&O(o)}}function Ee(){var t;e.eager&&((t=h.value)==null||t.calculateVisibleItems())}function Be(){var t;c.value&&(k.value=!0,(t=s.value)==null||t.focus())}function Ne(t){c.value=!0,setTimeout(()=>{C.value=!0})}function $e(t){C.value=!1}function ze(t){(t==null||t===""&&!e.multiple&&!Q.value)&&(l.value=[])}const le=X(!1);function O(t){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!t||t.props.disabled))if(e.multiple){const f=l.value.findIndex(p=>(e.valueComparator||Xe)(p.value,t.value)),u=o??!~f;if(~f){const p=u?[...l.value,t]:[...l.value];p.splice(f,1),l.value=p}else u&&(l.value=[...l.value,t]);e.clearOnSelect&&(g.value="")}else{const f=o!==!1;l.value=f?[t]:[],g.value=f&&!Q.value?t.title:"",ye(()=>{y.value=!1,k.value=!0})}}return j(c,(t,o)=>{var f;t!==o&&(t?(le.value=!0,g.value=e.multiple||Q.value?"":String(((f=l.value.at(-1))==null?void 0:f.props.title)??""),k.value=!0,ye(()=>le.value=!1)):(!e.multiple&&g.value==null&&(l.value=[]),y.value=!1,g.value="",n.value=-1))}),j(g,t=>{!c.value||le.value||(t&&(y.value=!0),k.value=!t)}),j(y,()=>{if(!e.hideSelected&&y.value&&l.value.length){const t=M.value.findIndex(o=>l.value.some(f=>o.value===f.value));Ye&&window.requestAnimationFrame(()=>{var o;t>=0&&((o=h.value)==null||o.scrollToIndex(t))})}}),j(d,(t,o)=>{y.value||c.value&&!o.length&&t.length&&(y.value=!0)}),yt(()=>{const t=!!(!e.hideNoData||M.value.length||a["prepend-item"]||a["append-item"]||a["no-data"]),o=l.value.length>0,f=be.filterProps(e);return r(be,R({ref:s},f,{modelValue:g.value,"onUpdate:modelValue":[u=>g.value=u,ze],focused:c.value,"onUpdate:focused":u=>c.value=u,validationValue:l.externalValue,counterValue:W.value,dirty:o,onChange:Oe,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":y.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!Q.value,"v-autocomplete--selecting-index":n.value>-1},e.class],style:e.style,readonly:U.isReadonly.value,placeholder:o?void 0:e.placeholder,"onClick:clear":Me,"onMousedown:control":Re,onKeydown:Ue,"aria-expanded":_e.value,"aria-controls":Ae.value}),{...a,default:()=>V(N,null,[r(it,R({id:Ie.value,ref:F,modelValue:y.value,"onUpdate:modelValue":u=>y.value=u,activator:"parent",contentClass:"v-autocomplete__content",disabled:G.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:Ee,onAfterLeave:Be},e.menuProps),{default:()=>[t&&r(rt,R({ref:ae,filterable:!0,selected:Pe.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:u=>u.preventDefault(),onKeydown:Te,onFocusin:Ne,onFocusout:$e,tabindex:"-1",selectable:!0,"aria-live":"polite",color:e.itemColor??e.color},Fe,e.listProps),{default:()=>{var u,p,P;return[(u=a["prepend-item"])==null?void 0:u.call(a),!M.value.length&&!e.hideNoData&&(((p=a["no-data"])==null?void 0:p.call(a))??r(ie,{key:"no-data",title:D(e.noDataText)},null)),r(ct,{ref:h,renderless:!0,items:M.value,itemKey:"value"},{default:A=>{var fe,me,pe;let{item:i,index:v,itemRef:b}=A;const ve=R(i.props,{ref:b,key:i.value,active:ee.value&&v===0?!0:void 0,onClick:()=>O(i,null)});return i.type==="divider"?((fe=a.divider)==null?void 0:fe.call(a,{props:i.raw,index:v}))??r(re,R(i.props,{key:`divider-${v}`}),null):i.type==="subheader"?((me=a.subheader)==null?void 0:me.call(a,{props:i.raw,index:v}))??r(dt,R(i.props,{key:`subheader-${v}`}),null):((pe=a.item)==null?void 0:pe.call(a,{item:i,index:v,props:ve}))??r(ie,R(ve,{role:"option"}),{prepend:J=>{let{isSelected:je}=J;return V(N,null,[e.multiple&&!e.hideSelected?r(ft,{key:i.value,modelValue:je,ripple:!1,tabindex:"-1"},null):void 0,i.props.prependAvatar&&r(kt,{image:i.props.prependAvatar},null),i.props.prependIcon&&r(Z,{icon:i.props.prependIcon},null)])},title:()=>{var J;return k.value?i.title:Ct("v-autocomplete",i.title,(J=De(i))==null?void 0:J.title)}})}}),(P=a["append-item"])==null?void 0:P.call(a)]}})]}),l.value.map((u,p)=>{function P(b){b.stopPropagation(),b.preventDefault(),O(u,!1)}const A={"onClick:close":P,onKeydown(b){b.key!=="Enter"&&b.key!==" "||(b.preventDefault(),b.stopPropagation(),P(b))},onMousedown(b){b.preventDefault(),b.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},i=Y.value?!!a.chip:!!a.selection,v=i?Je(Y.value?a.chip({item:u,index:p,props:A}):a.selection({item:u,index:p})):void 0;if(!(i&&!v))return V("div",{key:u.value,class:et(["v-autocomplete__selection",p===n.value&&["v-autocomplete__selection--selected",_.value]]),style:Ze(p===n.value?S.value:{})},[Y.value?a.chip?r(Vt,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:u.title}}},{default:()=>[v]}):r(mt,R({key:"chip",closable:e.closableChips,size:"small",text:u.title,disabled:u.props.disabled},A),null):v??V("span",{class:"v-autocomplete__selection-text"},[u.title,e.multiple&&p<l.value.length-1&&V("span",{class:"v-autocomplete__selection-comma"},[K(",")])])])})]),"append-inner":function(){var A,i;for(var u=arguments.length,p=new Array(u),P=0;P<u;P++)p[P]=arguments[P];return V(N,null,[(A=a["append-inner"])==null?void 0:A.call(a,...p),e.menuIcon?r(Z,{class:"v-autocomplete__menu-icon",color:(i=s.value)==null?void 0:i.fieldIconColor,icon:e.menuIcon,onMousedown:Le,onClick:Ge,"aria-label":de.value,title:de.value,tabindex:"-1"},null):void 0])}})}),Dt({isFocused:c,isPristine:k,menu:y,search:g,filteredItems:H,select:O},s)}}),ta=ce({__name:"PlayerSearch",props:{label:{default:"Player name"}},emits:["model-value"],setup(e,{emit:w}){const a={"FODD#11256":"Wiki developer","CrazyFly#2731":"Тупой хуесосик","ПышныйБосс#2287":"Cool player","theMOA#2185":"World best player","snupi#21238":"Hope of the barracks","opaca#1428":"Brazilian pawn shop","Krabster#2533":"Главный по кастрюлькам","OUTSDORF#2608":"True skill"},D=w,s=Ve(),c=T(void 0),k=T([]),C=T(!1);return tt(F=>{if(!c.value)return;const h=new AbortController;F(()=>h.abort());const n=new URL("/match/players",s.public.backendUrl);n.searchParams.set("name",c.value??""),C.value=!0,fetch(n,{signal:h.signal}).then(d=>d.json()).then(d=>{Array.isArray(d)&&(k.value=d)}).finally(()=>{C.value=!1})},{flush:"post"}),(F,h)=>(I(),q(Mt,{label:e.label,search:m(c),"onUpdate:search":h[0]||(h[0]=n=>we(c)?c.value=n:null),loading:m(C),items:m(k),autocomplete:"off","hide-details":"",density:"compact",clearable:"",variant:"outlined","onUpdate:modelValue":h[1]||(h[1]=n=>D("model-value",n==null?void 0:n.id)),"item-title":"name","item-value":"id","hide-no-data":"",placeholder:"Start type nickname"},{item:E(({props:n,item:d})=>[r(ie,R({density:"comfortable"},n),{default:E(()=>[d.raw.name in a?(I(),q(ke,{key:0,class:"text-white"},{default:E(()=>[K(L(a[d.raw.name]),1)]),_:2},1024)):xe("",!0),r(ke,null,{default:E(()=>[K(L(d.raw.platform),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["label","search","loading","items"]))}}),Rt=async(e,w,a)=>{const D=await Promise.all(e.map(s=>Se(s,w,a)));return Object.fromEntries(D.map(s=>[s.raceData.id,s]))},Lt=e=>{const w=Math.floor(e/1e3)%60,a=Math.floor(e/1e3/60)%60;return[Math.floor(e/1e3/60/60)%24,a,w].map(String).map(s=>s.padStart(2,"0")).join(":")},Tt={class:"d-flex align-center py-2"},Ut={class:"players-row d-flex"},Ot={class:"name text-truncate text-subtitle-2 flex-grow-0 flex-shrink-0"},Et=["title"],Bt=ce({__name:"MatchListItem",props:{item:{},versionType:{},version:{}},emits:["click"],async setup(e,{emit:w}){let a,D;const s=w,{raceData:c,iconsSrc:k,iconProps:C}=([a,D]=ue(()=>Se("races",e.versionType,e.version)),a=await a,D(),a),F=x(()=>{const _=e.item.players.map(({race:S})=>S);return Object.values(c).flat().filter(({id:S})=>_.includes(S)).map(({key:S})=>S)}),h=([a,D]=ue(()=>Rt(F.value,e.versionType,e.version)),a=await a,D(),a),n=x(()=>[...e.item.players].sort((_,S)=>_.place-S.place)),d=x(()=>new Date(e.item.endAt).toLocaleString()),$=x(()=>Lt(e.item.duration)),z=x(()=>{switch(e.item.platform){case"W3Champions":return`https://w3champions.com/match/${e.item.platformId}`;default:return""}});return(_,S)=>{const g=_t;return I(),B(N,null,[V("div",{class:"match-block px-2 py-1 my-2",onClick:S[1]||(S[1]=l=>s("click"))},[V("div",Tt,[V("div",null,L(m(d)),1),r(oe),V("div",null,L(e.item.quantile)+" quantile",1),r(oe),V("div",null,L(m($)),1),r(oe),r(pt,{variant:"text",href:m(z),target:"_blank",density:"comfortable",onClick:S[0]||(S[0]=at(()=>{},["stop"]))},{default:E(()=>[r(Z,null,{default:E(()=>[K(L(m(Pt)),1)]),_:1})]),_:1},8,["href"])]),V("div",Ut,[(I(!0),B(N,null,se(m(n),l=>(I(),B("div",{key:l.id,class:"player-inline d-flex align-center"},[V("span",Ot,[K(L(l.place)+". ",1),V("span",{title:l.name},L(l.name),9,Et)]),r(g,{src:m(k),coords:m(C)(l.race),description:m(h)[l.race].raceData.name,width:"32",class:"mx-2"},null,8,["src","coords","description"]),l.bonus.length?(I(),q(re,{key:0,vertical:""})):xe("",!0),(I(!0),B(N,null,se(l.bonus,W=>{var U;return I(),q(g,{key:W,src:m(h)[l.race].iconsSrc,coords:m(h)[l.race].iconProps(W),description:(U=m(h)[l.race].raceData.bonuses.find(({id:H})=>H===W))==null?void 0:U.name,width:"32",class:""},null,8,["src","coords","description"])}),128))]))),128))])]),r(re)],64)}}}),Nt=Ce(Bt,[["__scopeId","data-v-89ec2f26"]]),$t={class:"list-body d-flex flex-column"},zt={key:2,class:"d-flex flex-column align-center justify-center mt-8 text-medium-emphasis"},jt=ce({__name:"MatchesList",props:{filters:{},perPage:{}},async setup(e){let w,a;const D=Ve(),s=T(null),c=T(1);j(()=>e.filters,()=>{c.value=1},{deep:!0}),j(()=>c.value,()=>{s.value&&s.value.scrollTo({top:0})});const k=x(()=>({...e.filters,page:c.value,perPage:e.perPage})),{data:C,status:F}=([w,a]=ue(()=>At("/match/filter",{baseURL:D.public.backendUrl,server:!1,method:"POST",body:k,watch:[k],deep:!0},"$ousmf9UlE0")),w=await w,a(),w),h=x(()=>{var n,d;return Math.ceil((((n=C.value)==null?void 0:n.total)??1)/(((d=C.value)==null?void 0:d.perPage)??10))});return(n,d)=>{var $,z;return I(),B("div",{ref_key:"bodyRef",ref:s},[V("div",$t,[m(F)==="pending"?(I(),q(ht,{key:0,indeterminate:"",size:"60",class:"mx-auto my-8"})):(z=($=m(C))==null?void 0:$.data)!=null&&z.length?(I(!0),B(N,{key:1},se(m(C).data,_=>(I(),q(Nt,{key:_.id,item:_,"version-type":e.filters.type,version:e.filters.version},null,8,["item","version-type","version"]))),128)):(I(),B("div",zt,[r(Z,{size:"64",class:"mb-4"},{default:E(()=>[K(L(m(It)),1)]),_:1}),d[1]||(d[1]=V("div",{class:"text-h6"},"No matches found",-1))]))]),r(St,{modelValue:m(c),"onUpdate:modelValue":d[0]||(d[0]=_=>we(c)?c.value=_:null),length:m(h)},null,8,["modelValue","length"])],512)}}}),aa=Ce(jt,[["__scopeId","data-v-cc701a46"]]);export{aa as M,ta as _,Lt as f};
